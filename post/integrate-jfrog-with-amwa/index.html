<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width"><script type=application/javascript src=https://sanchitdilipjain.github.io/js/theme-mode.js></script><link rel=stylesheet href=https://sanchitdilipjain.github.io/css/frameworks.min.css><link rel=stylesheet href=https://sanchitdilipjain.github.io/css/github.min.css><link rel=stylesheet href=https://sanchitdilipjain.github.io/css/github-style.css><link rel=stylesheet href=https://sanchitdilipjain.github.io/css/light.css><link rel=stylesheet href=https://sanchitdilipjain.github.io/css/dark.css><link rel=stylesheet href=https://sanchitdilipjain.github.io/css/syntax.css><title>Integrate Jfrog Artifactory with AWS Managed workflow for Apache Airflow üîç - Sanchit's blog</title>
<link rel=icon type=image/x-icon href=https://sanchitdilipjain.github.io/images/github.png><meta name=theme-color content="#1e2327"><meta name=description content="Never become so much of an expert that you stop gaining expertise. View life as a continuous learning experience."><meta name=robots content="noodp"><link rel=canonical href=https://sanchitdilipjain.github.io/post/integrate-jfrog-with-amwa/><meta name=twitter:card content="summary"><meta name=twitter:title content="Sanchit's Blog"><meta name=twitter:description content="Integrate Jfrog Artifactory with AWS Managed workflow for Apache Airflow Overview
When managing data pipelines and workflows in AWS Managed Apache Airflow, it&rsquo;s often necessary to integrate with various external services for tasks such as downloading binaries, libraries, or other dependencies. JFrog Artifactory is a popular binary repository manager that allows you to securely store and manage artifacts. Integrating JFrog with AWS Managed Apache Airflow enables seamless and secure downloading of these artifacts, ensuring that your workflows can reliably access the necessary resources. This integration is crucial for maintaining consistency and security across your deployment pipelines, allowing you to automate complex workflows without manual intervention. By using AWS Secrets Manager and a startup script, we can securely manage the credentials required for this integration, ensuring that sensitive information is handled safely. Demo
"><meta name=twitter:site content="https://sanchitdilipjain.github.io/"><meta name=twitter:creator content="Sanchit Jain"><meta name=twitter:image content="https://sanchitdilipjain.github.io//images/preview.png"><meta property="og:type" content="article"><meta property="og:title" content="Sanchit's Blog"><meta property="og:description" content="Never become so much of an expert that you stop gaining expertise. View life as a continuous learning experience."><meta property="og:url" content="https://sanchitdilipjain.github.io/"><meta property="og:site_name" content="Sanchit's Blog"><meta property="og:image" content="https://sanchitdilipjain.github.io//images/preview.png"><meta property="og:image:type" content="image/png"><meta name=thumbnail content="https://sanchitdilipjain.github.io//images/preview.png"><meta name=author content="Sanchit Jain"><meta property="article:published_time" content="2024-06-19 12:00:00 +0000 UTC"></head><body><style>.height-limitation{max-height:300px;overflow-y:scroll}.loader{border:4px solid #f3f3f3;border-bottom:4px solid var(--color-fg-muted);border-radius:50%;width:30px;height:30px;animation:spin 1s linear infinite;margin:0 auto}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}</style><div style=position:relative><header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on"><div class="Header-item mobile-none" style=margin-top:-4px;margin-bottom:-4px><a class=Header-link href=https://sanchitdilipjain.github.io/><svg class="octicon" height="32" viewBox="0 0 16 16" width="32"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class="Header-item d-md-none"><button class="Header-link btn-link js-details-target" type=button onclick='document.querySelector("#header-search").style.display=document.querySelector("#header-search").style.display=="none"?"block":"none"'><svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" width="24"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button></div><div style=display:none id=header-search class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex"><div class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to"><div class=position-relative><form target=_blank action=https://www.google.com/search accept-charset=UTF-8 method=get autocomplete=off><label class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center"><input type=text class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable" name=q placeholder=Search autocomplete=off>
<input type=hidden name=q value=site:https://sanchitdilipjain.github.io/><div class="js-jump-to-suggestions-container jump-to-suggestions overflow-hidden position-absolute"><div id=search-progress class="d-none color-bg-primary no-underline p-2" role=progress aria-selected=false><div class=loader></div></div><ul id=jump-to-results role=listbox class="Box border-0 p-0 m-0 js-navigation-container jump-to-suggestions-results-container js-jump-to-suggestions-results-container js-active-navigation-container height-limitation"></ul></div></label></form></div></div></div><div class="Header-item Header-item--full flex-justify-center d-md-none position-relative"><a class=Header-link href=https://sanchitdilipjain.github.io/><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class=Header-item style=margin-right:0><a href=javascript:void(0) class="Header-link no-select" onclick=switchTheme()><svg style="fill:var(--color-profile-color-modes-toggle-moon)" class="no-select" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.52208 7.71754c3.05612.0 5.53362-2.47748 5.53362-5.5336C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961 9.95801 1.07727 10.3495.771159 10.6474.99992c1.4679 1.12724 2.4141 2.90007 2.4141 4.89391.0 3.40575-2.7609 6.16667-6.16665 6.16667-2.94151.0-5.40199-2.0595-6.018122-4.81523C.794841 6.87902 1.23668 6.65289 1.55321 6.85451 2.41106 7.40095 3.4296 7.71754 4.52208 7.71754z"/></svg></a></div></header></div><div><main><div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4"><div class=px-0><div class="mb-3 d-flex px-3 px-md-3 px-lg-5"><div class="flex-auto min-width-0 width-fit mr-3"><div class=d-flex><div class="d-none d-md-block"><a class="avatar mr-2 flex-shrink-0" href=https://sanchitdilipjain.github.io/><img class=avatar-user src=https://sanchitdilipjain.github.io/images/avatar.png width=32 height=32></a></div><div class="d-flex flex-column"><h1 class="break-word f3 text-normal mb-md-0 mb-1"><span class=author><a href=https://sanchitdilipjain.github.io/>Sanchit Dilip Jain</a></span><span class=path-divider>/</span><strong class="css-truncate-target mr-1" style=max-width:410px><a href=https://sanchitdilipjain.github.io/post/integrate-jfrog-with-amwa/>Integrate Jfrog Artifactory with AWS Managed workflow for Apache Airflow üîç</a></strong></h1><div class="note m-0">Created <relative-time datetime="Wed, 19 Jun 2024 12:00:00 +0000" class=no-wrap>Wed, 19 Jun 2024 12:00:00 +0000</relative-time>
<span class=file-info-divider></span>
Modified <relative-time datetime="Fri, 06 Dec 2024 12:56:40 +0000" class=no-wrap>Fri, 06 Dec 2024 12:56:40 +0000</relative-time></div></div></div></div></div></div></div><div class="container-lg px-3 new-discussion-timeline"><div class="repository-content gist-content"><div><div class="js-gist-file-update-container js-task-list-container file-box"><div id=file-pytest class="file my-2"><div id=post-header class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style=z-index:2><div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0"><summary id=toc-toggle onclick=clickToc() class="btn btn-octicon m-0 mr-2 p-2"><svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered"><path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zm0 5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zm0 5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zM3 8A1 1 0 111 8a1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"/></svg></summary><details-menu class=SelectMenu id=toc-details style="display: none;"><div class="SelectMenu-modal rounded-3 mt-1" style=max-height:340px><div class="SelectMenu-list SelectMenu-list--borderless p-2" style=overscroll-behavior:contain id=toc-list></div></div></details-menu>700 Words
<span class=file-info-divider></span>
3 min</div></div></div><div class="Box-body px-5 pb-5" style=z-index:1><article class="markdown-body entry-content container-lg"><h2 id=integrate-jfrog-artifactory-with-aws-managed-workflow-for-apache-airflow>Integrate Jfrog Artifactory with AWS Managed workflow for Apache Airflow</h2><p><strong>Overview</strong></p><ul><li>When managing data pipelines and workflows in AWS Managed Apache Airflow, it&rsquo;s often necessary to integrate with various external services for tasks such as downloading binaries, libraries, or other dependencies.</li><li>JFrog Artifactory is a popular binary repository manager that allows you to securely store and manage artifacts. Integrating JFrog with AWS Managed Apache Airflow enables seamless and secure downloading of these artifacts, ensuring that your workflows can reliably access the necessary resources.</li><li>This integration is crucial for maintaining consistency and security across your deployment pipelines, allowing you to automate complex workflows without manual intervention.</li><li>By using AWS Secrets Manager and a startup script, we can securely manage the credentials required for this integration, ensuring that sensitive information is handled safely.</li></ul><p><strong>Demo</strong></p><ul><li><p>Managing secrets securely is crucial when working with workflows that require sensitive data, such as authentication tokens or API keys. AWS Managed Apache Airflow provides a robust platform for orchestrating workflows but requires careful handling of secrets.</p></li><li><p>This blog post will guide you through the steps to securely insert secrets during the initialization of AWS Managed Apache Airflow to download binaries from JFrog.</p><ul><li><p><strong>Prerequisites</strong></p><ul><li>AWS Account with access to Managed Apache Airflow.</li><li>AWS CLI configured on your local machine.</li><li>JFrog Artifactory account and API key.</li><li>AWS Secrets Manager setup to store JFrog credentials.</li><li>S3 bucket to store the startup script.</li></ul></li><li><p><strong>Step 1:</strong> Store JFrog Credentials in AWS Secrets Manager</p><ul><li>AWS Secrets Manager in the AWS Management Console.</li><li>Create a new secret and select Other type of secret.</li><li>Add key/value pairs for your JFrog credentials (e.g., username and api_key).</li><li>Name your secret, e.g., jfrog/credentials.</li><li>Save the secret and note down the Secret ARN.</li></ul></li><li><p><strong>Step 2:</strong> Create a Startup Script</p><ul><li><p>Create a startup script that will be executed during the initialization of the Airflow environment. This script will fetch the secrets from AWS Secrets Manager and set them as environment variables.</p><pre tabindex=0><code>#!/bin/bash

# Install AWS CLI if not already installed
if ! command -v aws &amp;&gt; /dev/null
then
    echo &#34;AWS CLI not found. Installing...&#34;
    curl &#34;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&#34; -o &#34;awscliv2.zip&#34;
    unzip awscliv2.zip
    sudo ./aws/install
fi

# Fetch the secrets from AWS Secrets Manager
SECRET=$(aws secretsmanager get-secret-value --secret-id jfrog/credentials --query SecretString --output text)
USERNAME=$(echo $SECRET | jq -r .username)
API_KEY=$(echo $SECRET | jq -r .api_key)

# Set environment variables
echo &#34;export JFROG_USERNAME=$USERNAME&#34; &gt;&gt; /etc/environment
echo &#34;export JFROG_API_KEY=$API_KEY&#34; &gt;&gt; /etc/environment
</code></pre></li><li><p>Save this script as init_script.sh.</p></li></ul></li><li><p><strong>Step 3:</strong> Upload the Startup Script to S3</p><ul><li><p>Upload the init_script.sh to an S3 bucket that your Airflow environment has access to.</p><pre tabindex=0><code>aws s3 cp init_script.sh s3://your-bucket-name/init_script.sh
</code></pre></li></ul></li><li><p><strong>Step 4:</strong> Configure AWS Managed Apache Airflow to Use the Startup Script</p><ul><li><p>Modify the environment section of your Airflow environment to use the startup script from the S3 bucket.</p></li><li><p>Open the Amazon MWAA console.</p></li><li><p>Select your environment.</p></li><li><p>Edit the environment.In the Environment class section, add the S3 path to the startup script in the Startup script file field (e.g., s3://your-bucket-name/init_script.sh).</p></li></ul></li><li><p><strong>Step 5:</strong> Modify Airflow DAG to Use Environment Variables</p><ul><li><p>Modify your Airflow DAG to use the environment variables set by the startup script for authentication.</p><pre tabindex=0><code>from airflow import DAG
from airflow.operators.python import PythonOperator
from airflow.utils.dates import days_ago
import os
import requests

# Define default arguments
default_args = {
    &#39;owner&#39;: &#39;airflow&#39;,
    &#39;start_date&#39;: days_ago(1)
}

# Define the DAG
dag = DAG(
    &#39;download_binaries_from_jfrog&#39;,
    default_args=default_args,
    schedule_interval=None,
)

def download_binaries():
    # Retrieve secrets from environment variables
    username = os.getenv(&#39;JFROG_USERNAME&#39;)
    api_key = os.getenv(&#39;JFROG_API_KEY&#39;)

    # JFrog API endpoint and headers
    jfrog_url = &#39;https://your-jfrog-instance/artifactory/path/to/your/binary&#39;
    headers = {
        &#39;Authorization&#39;: f&#39;Bearer {api_key}&#39;
    }

    # Download the binary
    response = requests.get(jfrog_url, headers=headers, auth=(username, api_key))

    if response.status_code == 200:
        with open(&#39;/path/to/save/binary&#39;, &#39;wb&#39;) as f:
            f.write(response.content)
    else:
        raise Exception(&#39;Failed to download binary from JFrog&#39;)

# Define the task
download_task = PythonOperator(
    task_id=&#39;download_binaries&#39;,
    python_callable=download_binaries,
    dag=dag,
)

download_task
</code></pre></li></ul></li><li><p><strong>Step 6:</strong> Deploy and Test the DAG</p><ul><li>Upload the DAG to your AWS Managed Apache Airflow environment.</li><li>Trigger the DAG manually via the Airflow UI to ensure it works correctly.</li></ul></li></ul></li></ul><p><strong>Conclusion</strong></p><ul><li>By following these steps, you can securely insert secrets during the initialization of AWS Managed Apache Airflow and download binaries from JFrog.</li><li>Using a startup script with AWS Secrets Manager ensures that your sensitive information is handled securely and dynamically at runtime, reducing the risk of exposure</li></ul></article></div></div></div></div></div><div class=pagination-nav><div class="pagination-button next-post"><div>¬´&nbsp;</div><a class="pagination-link link-reverse" href=https://sanchitdilipjain.github.io/post/debug-lambda-amazon-q/>Debugging Lambda Functions with Amazon Q üîç</a></div><div class="pagination-button previous-post"><a class="pagination-link link-reverse" href=https://sanchitdilipjain.github.io/post/integrate-secret-with-amwa/>Integrate AWS Secret Manager with AWS Managed...&nbsp;</a><div>¬ª</div></div></div></div></main></div><script type=application/javascript src=https://sanchitdilipjain.github.io/js/toc.js></script><link rel=stylesheet href=https://sanchitdilipjain.github.io/css/toc.css><div class="footer container-xl width-full p-responsive"><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><a aria-label=Homepage title=GitHub class="footer-octicon d-none d-lg-block mr-lg-4" href=https://sanchitdilipjain.github.io/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0"></li></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div></body><script type=application/javascript src=https://sanchitdilipjain.github.io/js/github-style.js></script><script src=https://sanchitdilipjain.github.io/js/mark.es6.min.js></script></html>